<!DOCTYPE html>
<html>
<head>
  <title>DropSocial</title>
  <%= stylesheet_link_tag 'reset', 'text', '960', 'jquery-ui-1.8.13.custom','front', 'shared', 'fullcalendar', 'facebox', :cache => !true %>  
  <%= stylesheet_link_tag 'formtastic', 'formtastic_changes', :cache => !true %>  
  <%= stylesheet_link_tag 'app' %>
  <%= javascript_include_tag :defaults, 'fullcalendar.min', 'facebox' %>
  <%= csrf_meta_tag %>
</head>
<body>

<div id="masthead_wrapper">
  <div class="container_16">
    <div id="masthead" class="grid_16">
      <a id="logo" href="/" class="image_button">
        <span>DropSOCIAL</span>
      </a><!-- #logo -->
      
      <% unless user_signed_in? %>
        <% if false %>
          <div id="login_wrapper">      
            <%= form_for(:user, :url => session_path(:user)) do |f| %>
              <%= f.submit 'Sign In' %>
              <%= f.password_field :password, :autocomplete => :off %>
              <%= f.email_field :email, :autocomplete => :off %>
            <% end %>
            <script type="text/javascript">
              $('#user_submit').button();
            </script>
          </div>
        <% end %>
      <% else %>
        <div class="greeting_wrapper">
          Hello <%= current_user.full_name %> <span id="user-info"></span>.  <%= link_to 'Sign Out', destroy_user_session_path %>
        </div><!-- .greeting_wrapper -->
      <% end %>
      
      <div class="clear"></div>
    </div><!-- #masthead.grid_16 -->
    
    <div class="clear"></div>
    
  </div><!-- .container_16 -->
</div><!-- #main_wrapper -->

<div id="content_wrapper">

  
  <!-- todo: flash mssg here -->

  <div class="container_16">
    <% if current_user %>
      <div id="nav_wrapper" class="">
        <ul id="nav" class="horizontal_list">
          <li><a href="/events">Events</a></li>
          <li><a href="/friends">Friends</a></li>
          <li><a href=""></a></li>
        </ul>
        <div class="clear"></div>
      </div><!-- #menu_wrapper -->
      <div class="clear"></div> 
    <% end %>

    
    <div id="content">
      <%= yield %>
      <div class="clear"></div>
    </div><!-- #masthead.grid_16 -->
    <div class="clear"></div>
  </div><!-- .container_16 -->
  
  <div id="cityscape">
    
  </div><!-- #cityscape -->
  
</div><!-- .content_wrapper -->


<div id="footer_wrapper">
  <div id="footer" class="container_16">
    <div class="grid_6">
      (C) 2011 DropSocial
      <div class="clear"></div>
    </div><!-- .grid_6 -->
    
    <div class="grid_4">
      
    </div><!-- .grid_4 -->
    
    <div class="clear"></div>
  </div><!-- #footer.grid_16 -->
</div><!-- #footer_wrapper -->

<%= render :partial => 'shared/confirm_primary_email' %>

<script src="http://connect.facebook.net/en_US/all.js"></script>

<div id="fb-root"></div><!-- #fb-root -->

<script>
  var fbApiKey = '<%= ENV['fb_api_key']%>';
  FB.init({ apiKey: fbApiKey });
  // no user, clear display
  function clearDisplay() {
    $('#user-info').hide('fast');
  }

  // handle a session response from any of the auth related calls
  function handleSessionResponse(response) {
    // debugger
    // if we dont have a session, just hide the user info
    if (!response.session) {
      clearDisplay();
      return;
    }

    // if we have a session, query for the user's profile picture and name
    // http://developers.facebook.com/docs/reference/fql/user/
    FB.api( { method: 'fql.query', query: 'SELECT name, pic_square FROM profile WHERE id=' + FB.getSession().uid },
      function(response) {
        var user = response[0];
        $('#user-info').html('<img src="' + user.pic_square + '" style="width:35px">').show('fast');
      }
    );
  }

  FB.getLoginStatus(handleSessionResponse);
</script>
</body>
</html>
